<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LuckyScratch Demo</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
      }
      .demo-wrapper {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      h2 {
        text-align: center;
        color: #333;
        margin-top: 0;
      }
      .config-panel {
        background: #f9f9f9;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 30px;
      }
      .config-row {
        margin-bottom: 15px;
      }
      .config-row label {
        display: inline-block;
        width: 120px;
        font-weight: 500;
        color: #666;
      }
      .config-row select,
      .config-row input {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      .config-row input[type='number'] {
        width: 80px;
      }
      .config-row input[type='color'] {
        width: 60px;
        height: 32px;
        border: none;
        cursor: pointer;
      }
      .container {
        position: relative;
        width: 300px;
        height: 150px;
        margin: 20px auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .prize-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-size: 24px;
        font-weight: bold;
      }
      .prize-content small {
        font-size: 16px;
        margin-top: 10px;
        opacity: 0.9;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }
      .button-group {
        text-align: center;
        margin-top: 20px;
      }
      button {
        padding: 10px 24px;
        font-size: 16px;
        cursor: pointer;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        margin: 0 5px;
        transition: background 0.3s;
      }
      button:hover {
        background: #5568d3;
      }
      button:active {
        transform: scale(0.98);
      }
      .tips {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 4px;
        padding: 12px;
        margin-top: 20px;
        font-size: 14px;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="demo-wrapper">
      <h2>ğŸ° åˆ®åˆ®å¡é…ç½®ç¤ºä¾‹</h2>
      <!-- é…ç½®é¢æ¿ -->
      <div class="config-panel">
        <h3 style="margin-top: 0; color: #333">é…ç½®é€‰é¡¹</h3>

        <div class="config-row">
          <label>é®ç½©ç±»å‹:</label>
          <select id="maskType" onchange="updateConfig()">
            <option value="color">çº¯è‰²é®ç½©</option>
            <option value="image">å›¾ç‰‡é®ç½©</option>
          </select>
        </div>

        <div class="config-row" id="colorRow">
          <label>é®ç½©é¢œè‰²:</label>
          <input
            type="color"
            id="maskColor"
            value="#cccccc"
            onchange="updateConfig()"
          />
          <span id="colorValue" style="margin-left: 10px; color: #666"
            >#cccccc</span
          >
        </div>

        <div class="config-row" id="imageRow" style="display: none">
          <label>é®ç½©å›¾ç‰‡:</label>
          <select id="maskImage" onchange="updateConfig()">
            <option value="./imgs/bg.png">bg.png</option>
            <option value="./imgs/0.png">0.png</option>
            <option value="./imgs/1.png">1.png</option>
            <option value="./imgs/2.png">2.png</option>
          </select>
        </div>

        <div class="config-row">
          <label>åˆ®ç—•åŠå¾„:</label>
          <input
            type="number"
            id="scratchRadius"
            value="20"
            min="5"
            max="50"
            onchange="updateConfig()"
          />
          <span style="margin-left: 5px; color: #666">px</span>
        </div>

        <div class="config-row">
          <label>å®Œæˆé˜ˆå€¼:</label>
          <input
            type="number"
            id="scratchPercent"
            value="50"
            min="10"
            max="100"
            onchange="updateConfig()"
          />
          <span style="margin-left: 5px; color: #666">%</span>
        </div>

        <div class="config-row">
          <label>å¯ç”¨æƒé™æ ¡éªŒ:</label>
          <input
            type="checkbox"
            id="enableAuth"
            checked
            onchange="updateConfig()"
          />
        </div>
      </div>

      <!-- åˆ®åˆ®å¡å®¹å™¨ -->
      <div class="container" id="my-scratch">
        <div class="prize-content">
          ğŸ‰ æ­å–œä¸­å¥– ğŸ‰
          <small>iPhone 15 Pro Max</small>
        </div>
      </div>

      <!-- æŒ‰é’®ç»„ -->
      <div class="button-group">
        <button onclick="resetScratch()">ğŸ”„ é‡æ–°åˆ®å¥–</button>
        <button onclick="toggleDisabled()">
          <span id="disableText">ğŸ”’ ç¦ç”¨åˆ®å¥–</span>
        </button>
      </div>

      <!-- æç¤ºä¿¡æ¯ -->
      <div class="tips">
        ğŸ’¡
        <strong>æç¤º:</strong>
        ä¿®æ”¹é…ç½®åä¼šè‡ªåŠ¨é‡æ–°åˆå§‹åŒ–åˆ®åˆ®å¡ã€‚åˆ®å¼€è¾¾åˆ°é˜ˆå€¼åä¼šè‡ªåŠ¨å…¨éƒ¨æ¸…é™¤å¹¶å¼¹å‡ºæç¤ºã€‚
        <br />
        ğŸ’¡
        <strong>åŠ¨æ€ç¦ç”¨:</strong>
        ç‚¹å‡»"ç¦ç”¨åˆ®å¥–"æŒ‰é’®å¯é€šè¿‡ setDisabled()
        æ–¹æ³•è¿è¡Œæ—¶æ§åˆ¶å¯ç”¨/ç¦ç”¨çŠ¶æ€ï¼ˆå¸¸ç”¨äºï¼šåˆ®å¥–å®Œæˆåã€æ´»åŠ¨ç»“æŸã€æ£€æµ‹åˆ°å¼‚å¸¸ç­‰åœºæ™¯ï¼‰ã€‚
      </div>
    </div>

    <script src="../dist/index.umd.js"></script>
    <script>
      let myScratch = null

      // æ¨¡æ‹Ÿæ¥å£è°ƒç”¨
      function checkPermission() {
        return new Promise((resolve) => {
          setTimeout(() => {
            // æ¨¡æ‹Ÿ 80% æ¦‚ç‡æœ‰èµ„æ ¼ï¼ˆæé«˜é€šè¿‡ç‡æ–¹ä¾¿æµ‹è¯•ï¼‰
            const hasPermission = Math.random() > 0.2
            resolve(hasPermission)
          }, 500)
        })
      }

      // è·å–å½“å‰é…ç½®
      function getConfig() {
        const maskType = document.getElementById('maskType').value
        const maskColor = document.getElementById('maskColor').value
        const maskImage = document.getElementById('maskImage').value
        const scratchRadius = parseInt(
          document.getElementById('scratchRadius').value
        )
        const scratchPercent =
          parseInt(document.getElementById('scratchPercent').value) / 100
        const enableAuth = document.getElementById('enableAuth').checked

        return {
          width: '300px',
          height: '150px',
          mask: {
            type: maskType,
            color: maskType === 'color' ? maskColor : undefined,
            src: maskType === 'image' ? maskImage : undefined,
          },
          scratch: {
            radius: scratchRadius,
            percent: scratchPercent,
          },
          onceBeforeStart: enableAuth
            ? async () => {
                console.log('æ­£åœ¨æ ¡éªŒåˆ®å¥–èµ„æ ¼...')
                const hasPermission = await checkPermission()
                if (!hasPermission) {
                  alert('æ‚¨æš‚æ— åˆ®å¥–èµ„æ ¼ï¼Œè¯·ç¨åå†è¯•ï¼')
                  return false
                }
                console.log('æ ¡éªŒé€šè¿‡ï¼Œå¯ä»¥å¼€å§‹åˆ®å¥–')
                return true
              }
            : undefined,
          start: () => {
            console.log('å¼€å§‹åˆ®å¥–')
          },
          end: () => {
            console.log('åœæ­¢åˆ®å¥–')
          },
          success: (progress) => {
            console.log('åˆ®å¥–å®Œæˆï¼Œå½“å‰è¿›åº¦:', progress)
            alert('ğŸ‰ æ­å–œä¸­å¥– iPhone 15 Pro Maxï¼')
          },
        }
      }

      // åˆå§‹åŒ–åˆ®åˆ®å¡
      function initScratch() {
        // æ¸…é™¤æ—§çš„ canvas
        const container = document.querySelector('#my-scratch')
        const oldCanvas = container.querySelector('canvas')
        if (oldCanvas) {
          oldCanvas.remove()
        }

        // åˆ›å»ºæ–°å®ä¾‹
        myScratch = new LuckyScratch(
          {
            el: '#my-scratch',
          },
          getConfig()
        )

        // åŒæ­¥ç¦ç”¨çŠ¶æ€åˆ°æŒ‰é’®æ–‡æœ¬
        updateDisableButtonText()
      }

      // æ›´æ–°é…ç½®
      function updateConfig() {
        const maskType = document.getElementById('maskType').value
        const colorRow = document.getElementById('colorRow')
        const imageRow = document.getElementById('imageRow')
        const maskColor = document.getElementById('maskColor').value
        const colorValue = document.getElementById('colorValue')

        // åˆ‡æ¢æ˜¾ç¤º
        if (maskType === 'color') {
          colorRow.style.display = 'block'
          imageRow.style.display = 'none'
        } else {
          colorRow.style.display = 'none'
          imageRow.style.display = 'block'
        }

        // æ›´æ–°é¢œè‰²æ˜¾ç¤º
        colorValue.textContent = maskColor

        // é‡æ–°åˆå§‹åŒ–
        initScratch()
      }

      // é‡ç½®åˆ®å¥–
      function resetScratch() {
        if (myScratch) {
          myScratch.init()
        }
      }

      // æ›´æ–°ç¦ç”¨æŒ‰é’®æ–‡æœ¬
      function updateDisableButtonText() {
        if (myScratch) {
          const disableText = document.getElementById('disableText')
          disableText.textContent = myScratch.disabled
            ? 'ğŸ”“ å¯ç”¨åˆ®å¥–'
            : 'ğŸ”’ ç¦ç”¨åˆ®å¥–'
        }
      }

      // åˆ‡æ¢ç¦ç”¨çŠ¶æ€
      function toggleDisabled() {
        if (myScratch) {
          // ä½¿ç”¨æ–°çš„ setDisabled æ–¹æ³•
          myScratch.setDisabled(!myScratch.disabled)
          updateDisableButtonText()
          console.log(
            'åˆ®å¥–çŠ¶æ€å·²åˆ‡æ¢:',
            myScratch.disabled ? 'å·²ç¦ç”¨' : 'å·²å¯ç”¨'
          )
        }
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.onload = function () {
        initScratch()
      }
    </script>
  </body>
</html>
