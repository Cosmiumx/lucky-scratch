<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2.x</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { text-align: center; color: #333; }
    .demo-section { margin: 40px auto; max-width: 600px; }
    .scratch-wrapper {
      position: relative;
      width: 300px;
      height: 150px;
      margin: 20px auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    .prize-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 24px;
      font-weight: bold;
    }
    .prize-content small { font-size: 16px; margin-top: 10px; opacity: 0.9; }
    .btn-group { text-align: center; margin-top: 15px; }
    button {
      padding: 8px 20px;
      margin: 0 5px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #5568d3; }
  </style>
</head>
<body>
    <script>
      var documentElement = document.documentElement;
      function callback() {
          var clientWidth = documentElement.clientWidth;
          // å±å¹•å®½åº¦å¤§äº780ï¼Œä¸åœ¨æ”¾å¤§
          clientWidth = clientWidth < 780 ? clientWidth : 780;
          documentElement.style.fontSize = clientWidth / 10 + 'px';
      }
      document.addEventListener('DOMContentLoaded', callback);
      window.addEventListener('orientationchange' in window ? 'orientationchange' : 'resize', callback);
    </script>
  <div id="app">
    <h2>Vue2 + LuckyCanvas ç¤ºä¾‹</h2>
    
    <!-- å¤§è½¬ç›˜ç¤ºä¾‹ -->
    <div class="demo-section">
      <h3 style="text-align: center;">å¤§è½¬ç›˜æŠ½å¥–</h3>
      <lucky-wheel
        ref="myLucky"
        width="10rem"
        height="10rem"
        :blocks="blocks"
        :prizes="prizes"
        :buttons="buttons"
        :default-style="defaultStyle"
        @start="click"
        @end="end"
      />
    </div>

    <!-- åˆ®åˆ®å¡ç¤ºä¾‹ -->
    <div class="demo-section">
      <h3 style="text-align: center;">åˆ®åˆ®å¡æŠ½å¥–</h3>
      <div class="scratch-wrapper">
        <div class="prize-content">
          ğŸ‰ æ­å–œä¸­å¥– ğŸ‰
          <small>iPhone 15 Pro Max</small>
        </div>
        <lucky-scratch
          ref="myScratch"
          width="300px"
          height="150px"
          :mask="scratchMask"
          :scratch="scratchConfig"
          @once-before-start="handleOnceBeforeStart"
          @start="handleScratchStart"
          @success="handleScratchSuccess"
        />
      </div>
      <div class="btn-group">
        <button @click="resetScratch">é‡æ–°åˆ®å¥–</button>
        <button @click="toggleScratch">{{ scratchDisabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}</button>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vue/composition-api@1.2.4/dist/vue-composition-api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-demi@0.11.4/lib/index.iife.js"></script>
  <script src="./dist/index.umd.js"></script>
  <script>
    console.log(window.getComputedStyle(document.documentElement).fontSize)
    var vm = new Vue({
      el: '#app',
      data: {
        // å¤§è½¬ç›˜é…ç½®
        blocks: [{ padding: '13px', background: '#d64737' }],
        prizes: [
          { title: '1å…ƒçº¢åŒ…', background: '#f9e3bb', fonts: [{ text: '1å…ƒçº¢åŒ…', top: '18%' }], range: 0.1 },
          { title: '100å…ƒçº¢åŒ…', background: '#f8d384', fonts: [{ text: '100å…ƒçº¢åŒ…', top: '18%' }], range: 0.2 },
          { title: '0.5å…ƒçº¢åŒ…', background: '#f9e3bb', fonts: [{ text: '0.5å…ƒçº¢åŒ…', top: '18%' }] },
          { title: '2å…ƒçº¢åŒ…', background: '#f8d384', fonts: [{ text: '2å…ƒçº¢åŒ…', top: '18%' }] },
          { title: '10å…ƒçº¢åŒ…', background: '#f9e3bb', fonts: [{ text: '10å…ƒçº¢åŒ…', top: '18%' }] },
          { title: '50å…ƒçº¢åŒ…', background: '#f8d384', fonts: [{ text: '50å…ƒçº¢åŒ…', top: '18%' }] },
        ],
        buttons: [
          { radius: '50px', background: '#d64737' },
          { radius: '45px', background: '#fff' },
          { radius: '41px', background: '#f6c66f', pointer: true },
          {
            radius: '35px', background: '#ffdea0',
            fonts: [{ text: 'å¼€å§‹\næŠ½å¥–', fontSize: '18px', top: -18 }]
          }
        ],
        defaultStyle: { fontColor: '#d64737', fontSize: '14px' },
        // åˆ®åˆ®å¡é…ç½®
        scratchMask: {
          type: 'color',
          color: '#ccc'
        },
        scratchConfig: {
          radius: 20,
          percent: 0.5
        },
        scratchDisabled: false
      },
      methods: {
        // å¤§è½¬ç›˜æ–¹æ³•
        click () {
          this.$refs.myLucky.play()
          setTimeout(() => {
            this.$refs.myLucky.stop()
          }, 100)
        },
        end (prize) {
          console.log(prize.fonts[0].text)
        },
        // åˆ®åˆ®å¡æ–¹æ³•
        handleOnceBeforeStart: function(resolve) {
          console.log('æ­£åœ¨æ ¡éªŒåˆ®å¥–èµ„æ ¼...')
          // æ¨¡æ‹Ÿå¼‚æ­¥æ ¡éªŒ
          setTimeout(function() {
            var hasPermission = Math.random() > 0.2
            if (!hasPermission) {
              alert('æ‚¨æš‚æ— åˆ®å¥–èµ„æ ¼ï¼Œè¯·ç¨åå†è¯•ï¼')
              resolve(false)
            } else {
              console.log('æ ¡éªŒé€šè¿‡ï¼Œå¯ä»¥å¼€å§‹åˆ®å¥–')
              resolve(true)
            }
          }, 500)
        },
        handleScratchStart: function() {
          console.log('å¼€å§‹åˆ®å¥–')
        },
        handleScratchSuccess: function(progress) {
          console.log('åˆ®å¥–å®Œæˆï¼Œè¿›åº¦:', progress)
          alert('ğŸ‰ æ­å–œä¸­å¥– iPhone 15 Pro Maxï¼')
        },
        resetScratch: function() {
          this.$refs.myScratch.init()
        },
        toggleScratch: function() {
          var lucky = this.$refs.myScratch.lucky
          if (lucky) {
            lucky.disabled = !lucky.disabled
            this.scratchDisabled = lucky.disabled
          }
        }
      }
    })
  </script>
</body>
</html>